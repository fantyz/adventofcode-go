package main

/*

--- Day 19: A Series of Tubes ---
Somehow, a network packet got lost and ended up here. It's trying to follow a routing diagram (your puzzle input), but it's confused about where to go.

Its starting point is just off the top of the diagram. Lines (drawn with |, -, and +) show the path it needs to take, starting by going down onto the only line connected to the top of the diagram. It needs to follow this path until it reaches the end (located somewhere within the diagram) and stop there.

Sometimes, the lines cross over each other; in these cases, it needs to continue going the same direction, and only turn left or right when there's no other option. In addition, someone has left letters on the line; these also don't change its direction, but it can use them to keep track of where it's been. For example:

     |
     |  +--+
     A  |  C
 F---|----E|--+
     |  |  |  D
     +B-+  +--+

Given this diagram, the packet needs to take the following path:

Starting at the only line touching the top of the diagram, it must go down, pass through A, and continue onward to the first +.
Travel right, up, and right, passing through B in the process.
Continue down (collecting C), right, and up (collecting D).
Finally, go all the way left through E and stopping at F.
Following the path to the end, the letters it sees on its path are ABCDEF.

The little packet looks up at you, hoping you can help it find the way. What letters will it see (in the order it would see them) if it follows the path? (The routing diagram is very wide; make sure you view it without line wrapping.)

Your puzzle answer was HATBMQJYZ.

--- Part Two ---
The packet is curious how many steps it needs to go.

For example, using the same routing diagram from the example above...

     |
     |  +--+
     A  |  C
 F---|--|-E---+
     |  |  |  D
     +B-+  +--+

...the packet would go:

6 steps down (including the first line at the top of the diagram).
3 steps right.
4 steps up.
3 steps right.
4 steps down.
3 steps right.
2 steps up.
13 steps left (including the F it stops on).
This would result in a total of 38 steps.

How many steps does the packet need to go?

Your puzzle answer was 16332.

*/

import (
	"fmt"
	"strings"
)

func main() {
	fmt.Println("Advent of Code 2017 - Day 19")
	letters, steps := NewMaze(puzzle).Run()
	fmt.Println("Letters encountered in the maze:", letters)
	fmt.Println("Steps taken:                    ", steps)
}

func NewMaze(in string) Maze {
	m := make(Maze, 0)

	for _, line := range strings.Split(in, "\n") {
		m = append(m, []byte(" "+line+" "))
	}
	var padding []byte
	for i := 0; i < len(m[0]); i++ {
		padding = append(padding, ' ')
	}
	m = append(m, padding)

	return m
}

type Maze [][]byte

func (m Maze) Run() (string, int) {
	letters := ""
	steps := 1

	x, y := m.FindEntry()
	dir := 'S'
	for {
		switch dir {
		case 'N':
			if m[y-1][x] == ' ' {
				switch {
				case m[y][x-1] != ' ':
					dir = 'W'
					continue
				case m[y][x+1] != ' ':
					dir = 'E'
					continue
				default:
					return letters, steps
				}
			}
			y--
			steps++
		case 'S':
			if m[y+1][x] == ' ' {
				switch {
				case m[y][x-1] != ' ':
					dir = 'W'
					continue
				case m[y][x+1] != ' ':
					dir = 'E'
					continue
				default:
					return letters, steps
				}
			}
			y++
			steps++
		case 'E':
			if m[y][x+1] == ' ' {
				switch {
				case m[y-1][x] != ' ':
					dir = 'N'
					continue
				case m[y+1][x] != ' ':
					dir = 'S'
					continue
				default:
					return letters, steps
				}
			}
			x++
			steps++
		case 'W':
			if m[y][x-1] == ' ' {
				switch {
				case m[y-1][x] != ' ':
					dir = 'N'
					continue
				case m[y+1][x] != ' ':
					dir = 'S'
					continue
				default:
					return letters, steps
				}
			}
			x--
			steps++
		default:
			panic("Unknown direction: " + string(dir))
		}

		if m[y][x] != '|' && m[y][x] != '-' && m[y][x] != '+' {
			letters += string(m[y][x])
		}
	}
}

func (m Maze) FindEntry() (int, int) {
	entry := -1
	for x := 0; x < len(m[0]); x++ {
		if m[0][x] != ' ' {
			entry = x
		}
	}
	return entry, 0
}

func (m Maze) Print() {
	for y := 0; y < len(m); y++ {
		for x := 0; x < len(m[y]); x++ {
			fmt.Print(string(m[y][x]))
		}
		fmt.Print("\n")
	}
}

const puzzle = `                                                                                                           |                                                                                             
   +-----+                                         +---------------------------------+               +-----|-------------------------------------------------------+       +-------------------+         
   |     |                                         |                                 |               |     |                                                       |       |                   |         
   |     |                                         |                                 |               |     |   +----Q--------------------------+                 +---------|-------------------|-+       
   |     |                                         |                                 |               |     |   |                               |                 | |       |                   | |       
   |     |     +---------------------+             +-+                               |               |     |   |                               |                 | |       |           +-------+ |       
   |     |     |                     |               |                               |               |     |   |                               |                 | |       |           |         |       
   |     |     |       +-------------------------------------------------------------|---------------|---------|-----+                 +-------+                 | |     +-|-+         |         |       
   |     |     |       |             |               |                               |               |     |   |     |                 |                         | |     | | |         |         |       
   |     |     +-+     |             |               |                               |               |     |   |     |                 |                         | |     | | |         |         |       
   |     |       |     |             |               |                               |               |     |   |     |                 |                         | |     | | |         |         |       
   |     |       |     |             |               |               +---------------|---------------|-----|-------------+             |                   +-------------+ | |         |   +-----|---+   
   |     |       |     |             |               |               |               |               |     |   |     |   |             |                   |     | |       | |         |   |     |   |   
   |     |       |     |             |   +-----------|---------------|---------------|-----------------------------------|---------------------------------|-----|-|-------|-|---------|---+     |   |   
   |     |       |     |             |   |           |               |               |               |     |   |     |   |             |                   |     | |       | |         |         |   |   
 +-------|-------|-----|-----------------------------|---------------+               |   +-----------|-----|---+     |   |         +---|--T----------------------|---------|---------------------------+ 
 | |     |       |     |             |   |           |                               |   |           |     |         |   |         |   |                   |     | |       | |         |         |   | | 
 +-----+ |       |     |             |   |           |                               |   |           | +---|-----------------------|-------------------------------|-----+ | |         |   +---------+ | 
   |   | |       |     |             |   |           |                               |   |           | |   |         |   |         |   |                   |     | |     | | |         |   |     |     | 
   |   | |       |     |             |   |           |                               | +-------------|-|---------------------------|---|-----------------------------------|-|-----------+ |     | +-+ | 
   |   | |       |     |             |   |           |                               | | |           | |   |         |   |         |   |                   |     | |     | | |         | | |     | | | | 
   |   | |       |     |             |   |           |       +-----------------------|---|---------------------------|-------------------------------------------------------|---------+ +-+     | | +-+ 
   |   | |       |     |             |   |           |       |                       | | |           | |   |         |   |         |   |                   |     | |     | | |                   | |     
   |   | |       |     |             |   |           |       |                       | | |           | |   |         |   |         |   |       +-----------+     | |     | | |                   | |     
   |   | |       |     |             |   |           |       |                       | | |           | |   |         |   |         |   |       |                 | |     | H |                   | |     
   |   | |       |     |             |   |           +-------------------------+     | | |           | |   |         |   |         |   |       |                 | |     | | |                   | |     
   |   | |       |     |             |   |                   |                 |     | | |           | |   |         |   |         |   |       |                 | |     | | |                   | |     
   |   | |       |     |             |   |                   |               +-|---------|-----------|-|-------------|---|-----------------------------------------+     | | |                   | |     
   |   | |       |     |             |   |                   |               | |     | | |           | |   |         |   |         |   |       |                 |       | | |                   | |     
   |   | |   +-+ +-----|-------------|-------------------------------------------------|-------------------------------------------|-------------------------------------|-|-|-------------------------+ 
   |   | |   | |       |             |   |                   |               | |     | | |           | |   |         |   |         |   |       |                 |       | | |                   | |   | 
   +-----|---|-|-------+   +---------------------------------|-----------------------|-|-|-----------------|---------|---|---------|-----------|-------------------------|---|---------------+   | |   | 
       | |   | |           |         |   |                   |               | |     | | |           | |   |         |   |         |   |       |                 |       | | |               |   | |   | 
   +-----|---+ +-----------|---------|-----------------------|---------------|-------|-|-|-------------|---|---------|---|---------------------|-------------------+     | | |               |   | |   | 
   |   | |                 |         |   |                   |               | |     | | |           | |   |         |   |         |   |       |                 | |     | | |               |   | |   | 
   +-----|-------------------------------------------------------+           | |     | | |           | |   |         |   |         |   |       |                 | |     | | |               |   | |   | 
       | |                 |         |   |                   |   |           | |     | | |           | |   |         |   |         |   |       |                 | |     | | |               |   | |   | 
       | +---+             |       +-----------------------------+       +---|-|-----|-----------------|---|---------|---|---------|---|-----------------+       | |     | | |               |   | |   | 
       |     |             |       | |   |                   |           |   | |     | | |           | |   |         |   |         |   |       |         |       | |     | | |               |   | |   | 
       |     |             |     +---|---------------+       |           |   | |     | | |           | |   |         |   |         |   +-------------+   |       | |     | | |               |   | | +-+ 
       |     |             |     | | |   |           |       |           |   | |     | | |           | |   |         |   |         |           |     |   |       | |     | | |               |   | | |   
     +-|-----------+       |     | | |   |           |       |   +-------------------|---|-------------|---|-------------|---------------------|---------|-+     | |     | | |               |   | | |   
     | |     |     |       |     | | |   |           |       |   |       |   | |     | | |           | |   |         |   |         |           |     |   | |     | |     | | |               |   | | |   
     | |     |     |       |     | | |   |           |       |   |       |   | | +---------------------|---|-----------------+     |           |     |   | |     | |     | | |             +-----|-+ |   
     | |     |     |       |     | | |   |           |       |   |       |   | | |   | | |           | |   |         |   |   |     |           |     |   | |     | |     | | |             | |   |   |   
     | +-----------|-------+     | | |   |           |       |   |       |   | | |   | | |           | |   |         |   |   |     |           |     |   | |     | |     | | |             | |   |   |   
     |       |     |             | | |   |           |       |   |       |   | | |   | | |           | |   |         |   |   |     |           |     |   | |     | |     | | |             | |   |   |   
     |       |     |             | | |   |           |       |   |       |   | | |   | | |           | |   |         |   |   +-----|-----------------|---|-|-------------|---|-------------|-|---+   |   
     |       |     |             | | |   |           |       |   |       |   | | |   | | |           | |   |         |   |         |           |     |   | |     | |     | | |             | |       |   
     |       |     |       +-------|-|---|-------------------------------|-----|-----|---|-----------|-|---|---------------------------------------------|-|-----|-----+ | | |             | |       |   
     |       |     |       |     | | |   |           |       |   |       |   | | |   | | |           | |   |         |   |         |           |     |   | |     | |   | | | |             | |       |   
     |       |     |       | +-+ | | |   |           |       |   |       |   | | |   | +-+           | |   +---------|-------------|-----------|---------|-|-----|---------|-------------------------+   
     |       |     |       | | | | | |   |           |       |   |       |   | | |   |               | |             |   |         |           |     |   | |     | |   | | | |             | |           
     | +-----|---------------|-----+ |   |           |       |   |       |   | | |   |               | |             |   |         |           |     |   | |     | |   | | | |             | |           
     | |     |     |       | | | |   |   |           |       |   |       |   | | |   |               | |             |   |         |           |     |   | |     | |   | | | |             | |           
     | | +-------------------|-|-|---|---|-----------+       |   |       |   | | |   |               | |           +-|-------------|-----------|---------|-------|-|-----|-------------+   | |           
     | | |   |     |       | | | |   |   |                   |   |       |   | | |   |               | |           | |   |         |           |     |   | |     | |   | | | |         |   | |           
     | | |   |     |       | | | | +-----|-----------------------|---------------|---|---------------|-------------------|---------|---+ +-----|-----------|-----|-----|-------------+ |   | |           
     | | |   |     |       | | | | | |   |                   |   |       |   | | |   |               | |           | |   |         |   | |     |     |   | |     | |   | | | |       | |   | |           
     | | |   |     |       | | | | | |   |                   +-----------|---|-------|-----------------|---------------------------|---|-|-----|---------|-|-----|-------|---|-------|-|-+ | |           
     | | |   |     |       | | | | | |   |                       |       |   | | |   |               | |           | |   |         |   | |     |     |   | |     | |   | | | |       | | | | |           
   +---|-|-------------------|-----|-|---------------------------------------|-------|---------------|-|-----------------|---------|-----|-----------|-----|-----|-|---|-|-|-|---------+ | +-----------+ 
   | | | |   |     |       | | | | | |   |                       |       |   | | |   |               | |           | |   |         |   | |     |     |   | |     | |   | | | |       |   |   |         | 
   | | | |   |     |       | | | | | |   |                       |       |   | | |   |               | |           | |   +---------|---------------------+ |     | |   | | | |       |   |   |         | 
   | | | |   |     |       | | | | | |   |                       |       |   | | |   |               | |           | |             |   | |     |     |     |     | |   | | | |       |   |   |         | 
   | | | |   +---+ |       | | | | | |   |                       |       | +-|-+ |   |               +-|-----------------+         |   | | +---------|-----|-----|-----|---|-+     +-|---|-----------+ | 
   | | | |       | |       | | | | | |   |                       |       | | |   |   |                 |           | |   |         |   | | |   |     |     |     | |   | | |       | |   |   |       | | 
   | | | +---------|-----------|---|-------------------------------------|-|-|-------|-----------+     |           | |   |         |   | | |   |     |     |     | |   | | |       | |   |   |       | | 
   | | |         | |       | | | | | |   |                       |       | | |   |   |           |     |           | |   |         |   | | |   |     |     |     | |   | | |       | |   |   |       | | 
   | | |         | |       | | | | | |   |                       |       | | |   |   |           |     |           | |   +---------|-----|-----------|-----|---------------|-+     | |   |   |       | | 
   | | |         | |       | | | | | |   |                       |       | | |   |   |           |     |           | |             |   | | |   |     |     |     | |   | | | |     | |   |   |       | | 
 +---+ |         | |       | | | | | |   |                   +------------Y|-|---|---------------------------------|-|-------------|---|-|-----|-----------------------|---|-|-----|-----|-+ |       | | 
 | |   |         | |       | | | | | |   |                   |   |       | | |   |   |           |     |           | |             |   | | |   |     |     |     | |   | | | |     | |   | | |       | | 
 | |   |         | |   +---+ | | | | |   |                   |   |       | | |   |   |           |     |           | |             |   | | |   |     |     |     | |   | | | |     | |   | | |       | | 
 | |   |         | |   |     | | | | |   |                   |   |       | | |   |   |           |     |           | |             |   | | |   |     |     |     | |   | | | |     | |   | | |       | | 
 | |   |       +-|-|---|---+ | | | | |   |                   +-----------|-|-|---|---------+     |     |           | |             |   | | |   |     |     +-----|-----|---------+ | |   | | |       | | 
 | |   |       | | |   |   | | | | | |   |                       |       | | |   |   |     |     |     |           | |             |   | | |   |     |           | |   | | | |   | | |   | | |       | | 
 | |   |     +---|-|-------+ | | | | +-----------------------------------|-|---------|-----|-----------|-----------|-|---+         |   | | |   |     |           | |   | | | |   | | |   | | |       | | 
 | |   |     | | | |   |     | | | |     |                       |       | | |   |   |     |     |     |           | |   |         |   | | |   |     |           | |   | | | |   | | |   | | |       | | 
 | |   |     | | | | +---------|-|-------|-----------------------|-----+ | | |   |   |     +-----|-----------------|-------------------|-|-|-------+ |           +-----|---|-|---|-|-|-----+ |       | | 
 | |   |     | | | | | |     | | | |     |                       |     | | | |   |   |           |     |           | |   |         |   | | |   |   | |             |   | | | |   | | |   |   |       | | 
 | |   |     | | | | +-|-----|---|-|-----|-----------------------|-----|-------+ |   |           |     |           | |   |         |   | | |   |   | |             |   | | | |   | | |   |   | +---+ +-+ 
 | |   |     | | | |   |     | | | |     |                       |     | | | | | |   |           |     |           | |   |         |   | | |   |   | |             |   | | | |   | | |   |   | |   |     
 | |   |     | | | |   |     | | | |     |                     +-|-----|---|-|-|-|-----------+   |     |           | |   +---------------|-----|---|---------------|---|-|---------|-|---+   | | +-|---+ 
 | |   |     | | | |   |     | | | |     |                     | |     | | | | | |   |       |   |     |           | |             |   | | |   |   | |             |   | | | |   | | |       | | | |   | 
 | |   |     | | | |   |     | +---|-----|-----------+         | |     | | | | | |   | +---------|-----|-------------|---+         |   | | |   |   | |           +-----|-|-----+ | | +-+     | | | | +-+ 
 | |   |     | | | |   |     |   | |     |           |         | |     | | | | | |   | |     |   |     |           | |   |         |   | | |   |   | |           | |   | | | | | | |   |     | | | | |   
 | |   |     +---|-|---|---+ |   | |     |           |         | |     | | | | | |   | |     |   |     |           | |   +---+     |   | | |   |   | |           | |   | | | | | | |   | +---|---|-|-+   
 | |   |       | | |   |   | |   | |     |           |         | |     | | | | | |   | |     |   |     |           | |       |     |   | | |   |   | |           | |   | | | | | | |   | |   | | | |     
 | |   |       | | |   |   | |   | |     |           |       +-|-|-----------|---------|-----|---|-----+         +-|-|-------|-----|-----|-|---------|-----------|-------|-|-|---------|-+   | | | |     
 | |   |       | | |   |   | |   | |     |           |       | | |     | | | | | |   | |     |   |               | | |       |     |   | | |   |   | |           | |   | | | | | | |   |     | | | |     
 | |   |       | | |   |   | |   | |     |           |       | | |     | | | | | +---------------|---------------|---|-----------------------------|---------------|-----|-|---|-------|-----|-|-------+ 
 | |   |       | | |   |   | |   | |     |           |       | | |     | | | | |     | |     |   |               | | |       |     |   | | |   |   | |           | |   | | | | | | |   |     | | | |   | 
 | |   |       | | |   |   | |   | +-----|-------------------|---|-----|---|---------|-----------|---------------|-|-----+ +-------|-------|-+ |   | |           | |   | | | | | | |   |     | | | |   | 
 | |   |       | | |   |   | |   |       |           |       | | |     | | | | |     | |     |   |               | | |   | | |     |   | | | | |   | |           | |   | | | | | | |   |     | | | |   | 
 | |   |       | | |   |   | |   |       |           |       | | |     | | | +-|-------|-----|---|---------------|---------|-------|---|-|---|-|-----------------|-------|-|-|-|-|-|---|-------|---+ +-+ 
 | |   |       | | |   |   | |   |       |           |       | | |     | | |   |     | |     |   |               | | |   | | |     |   | | | | |   | |           | |   | | | | | | |   |     | | |   |   
 | |   |     +---|-|-------------|-------|-----------------------|-----|-|-|-----+   | |     |   |               | | |   | | |     |   +-------+   | |           | |   | | | | | | |   +-+   | | |   |   
 | |   |     | | | |   |   | |   |       |           |       | | |     | | |   | |   | |     |   |               | | |   | | |     |     | | |     | |           | |   | | | | | | |     |   | | |   |   
 | |   |     | | | +---|---|-----|-------|-+         |       | | |     | | |   | |   | |     |   |               | | |   | | |     |     | | |     | |           | |   | | | | | | |     |   | | |   |   
 | |   |     | | |     |   | |   |       | |         |       | | |     | | |   | |   | |     |   |               | | |   | | |     |     | | |     | |           | |   | | | | | | |     |   | | |   |   
 | |   |     | | |     |   | |   |       | |         |   +-------|---------|---|-|-----|-------------------------|-|-|---+ | +-----|-----+ | |     | |           | |   | +-----+ +-|-----|---|-+ |   |   
 | |   |     | | |     |   | |   |       | |         |   |   | | |     | | |   | |   | |     |   |               | | |     |       |       | |     | |           | |   |   | |     |     |   |   |   |   
 | |   |     | | |     |   | |   |       | |         |   |   | | |     | | |   | |   | |     | +-------------------|-------|---------+     | |     | |           | |   |   | | +-------------|-------+   
 | |   |     | | |     |   | |   |       | |         |   |   | | |     | | |   | |   | |     | | |               | | |     |       | |     | |     | |           | |   |   | | |   |     |   |   |       
 | |   |     | | |     |   | |   |       | |         |   |   | | |     | | |   | |   | |     | | |               | +-|-----|---------------|-------|---------------|-+ | +-|---|-+ +---------|---|---+   
 | |   |     | | |     |   | |   |       | |         |   |   | | |     | | |   | |   | |     | | |               |   |     |       | |     | |     | |           | | | | | | | | |       |   |   |   |   
 | |   |     | | |     |   | |   |       | |         |   |   | | |     | | |   | |   | |     | | |               |   |     |       | |     | |     | |           | | | | | | | | |       |   |   |   |   
 | |   |     | | |     |   | |   |       | |         |   |   | | |     | | |   | |   | |     | | |               |   |     |       | |     | |     | |           | | | | | | | | |       |   |   |   |   
 | |   |     | | |     |   | |   |       | |         |   |   | | |     | | |   | |   | |     | | |               |   |     |       | |     | |     | |           | | | | | | | | |       |   |   |   |   
 | |   |     | | |     |   | |   |       | |         |   |   | | |     | | |   | |   | |     | | |               |   |     |       | |     | |     | |           | | | | | | | | |       |   |   |   |   
 | |   |     | | |     |   | |   |       | |         |   |   | | |     | | |   | |   | |     | | |               |   |     |       | |     | | +-----|-------------|-------|-|-|---------|---|-----+ |   
 | |   |     | | |     |   | |   |       | |         |   |   | | |     | | |   | |   | |     | | |               |   |     |       | |     | | |   | |           | | | | | | | | |       |   |   | | |   
 | |   |     | | |     |   | |   |       | |         |   |   | | |     | | |   | |   | |     | | |               |   |     |       | |     | | |   | |           | | | | | | | | |       |   |   | | |   
 | A   |     | | |     |   | |   |       | |         |   |   | | |     | | |   | |   | |     | | |               |   |     |       | |     | | |   | |           | | | | | | | | |       |   |   | | |   
 | |   |     | | |     |   | |   |       | |         |   |   | | |     | | |   | |   | |     | | |               |   |     |       | |     | | |   | |           | | | | | | | | |       |   |   | | |   
 | |   |     | | |     |   | |   |       | |         |   |   | | |     | | |   | |   | |     | | |               |   |     |       | |     | | |   | |           | | | | | | | | |       |   |   | | |   
 | |   |     | +-----------|-------------|-----------------------------|-|-----|-|---|-|-----|---|-----------------------------------|-------------|---------------------|-----|-+       |   |   | | |   
 | |   |     |   |     |   | |   |       | |         |   |   | | |     | | |   | |   | |     | | |               |   |     |       | |     | | |   | |           | | | | | | | |         |   |   | | |   
 | |   |     |   |     |   | |   |       | |         |   |   | | |     | | |   | |   | |   +---|-----------------|---|---------------|-----+ | |   | |           | | | | | | | |         |   |   | | |   
 | |   |     |   |     |   | |   |       | |         |   |   | | |     | | |   | |   | |   | | | |               |   |     |       | |       | |   | |           | | | | | | | |         |   |   | | |   
 | |   |     |   |     |   | |   |       | |         |   |   | | |     | | |   | |   | |   | | | |               |   |     |       | |       | |   | |           | | | | | | | |         |   |   | | |   
 | |   |     |   |     |   | |   |       | |         |   |   | | |     | | |   | |   | |   | | | |               |   |     |       | |       | |   | |           | | | | | | | |         |   |   | | |   
 | | +-------|---|-----|-------------------|-------------------|-|-------------|-|---------|-|-|-----------------|---|-------------|-|-+     | |   | |           | | | | | | | |         |   |   | | |   
 | | | |     |   |     |   | |   |       | |         |   |   | | |     | | |   | |   | |   | | | |               |   |     |       | | |     | |   | |           | | | | | | | |         |   |   | | |   
 | | | |     |   |     |   | |   |       | |         |   |   | | | +-------|---------|-----|-|-|-|---------------------------------|-|-|-----|-|-------------------|-+ +-|---+ |         |   |   | | |   
 | | | |     |   |     |   | |   |       | |         |   |   | | | |   | | |   | |   | |   | | | |               |   |     |       | | |     | |   | |           | |     | |   |         |   |   | | |   
 | | | |     |   |   +-----------------------------------|---|-|-------|-|-|---|-|---+ |   | | | |               |   |     |       | | |     | |   | |           | |     | |   |         |   |   | | |   
 | | | |     |   |   | |   | |   |       | |         |   |   | | | |   | | |   | |     |   | | | |               |   |     |       | | |     | |   | |           | |     | |   |         |   |   | | |   
 | | | |     |   |   | |   | |   |       | |         |   |   | | | |   | | |   | |     |   | | | |   +-----------|---------|-------|-------+ +-----+ |           | |     | +---|---------|---+   | | |   
 | | | |     |   |   | |   | |   |       | |         |   |   | | | |   | | |   | |     |   | | | |   |           |   |     |       | | |   |   |     |           | |     |     |         |       | | |   
 | | | |     |   |   | |   | |   |       | |         |   |   | | | |   | | |   | | +-------|-|-|-----|-----------|-------------------|---------------|-----------|-------------|---------|---------+ |   
 | | | |     |   |   | |   | |   |       | |         |   |   | | | |   | | |   | | |   |   | | | |   |           |   |     |       | | |   |   |     |           | |     |     |         |       |   |   
 | | | |     |   |   | |   | |   |       | |         |   |   | | | |   | | |   | | |   |   | | | |   |           |   |     |       | | |   |   |     |           | |     |     |         |       |   |   
 | | | |     |   |   | |   | |   |       | |         |   |   | | | |   | | |   | | |   |   | | | |   |           |   |     |       | | |   |   |     |           | |     |     |         |       |   |   
 | | | |     |   |   | |   | |   |       | |         |   |   | | | |   | | |   | | |   |   | | | |   |           |   |     |       | | |   |   |     |         +---|-----|-----+         |       |   |   
 | | | |     |   |   | |   | |   |       | |         |   |   | | | |   | | |   | | |   |   | | | |   |           |   |     |       | | |   |   |     |         | | |     |               |       |   |   
 | | | |     |   |   | |   | |   |       | |         |   |   | | | |   | | |   | | |   |   | | | |   |           |   |     |       | | |   |   |     |         | | |     |               |       |   |   
 | | | |     |   |   B |   | |   |       | |         |   |   | | | |   | | |   | | |   |   | | | |   |           |   |     |       | | |   |   |     |         | | |     |               |       |   |   
 | | | |     |   |   | |   | |   |       | |   +-----|---|---|-----------------------------+ | | |   |           |   |     |       | | |   |   |     |         | | |     |               |       |   |   
 | | | |     |   |   | |   | |   |       | |   |     |   |   | | | |   | | |   | | |   |     | | |   |           |   |     |       | | |   |   |     |         | | |     |               |       |   |   
 | | | |     |   |   | |   +-|---|-------|-------------------------|---|-------|-|-|-------------+   |           |   |     |       | | |   |   |     |         | | |     |               |       |   |   
 | | | |     |   |   | |     |   |       | |   |     |   |   | | | |   | | |   | | |   |     | |     |           |   |     |       | | |   |   |     |         | | |     |               |       |   |   
 | | | |     +-------|-|-----|---|-------|-----+     |   |   | | | |   | | |   | | |   |     | |     |         +-|---|---------------|-|---|---|-----|---------|---------------+         |       |   |   
 | | | |         |   | |     |   |       | |         |   |   | | | |   | | |   | | |   |     | |     |         | |   |     |       | | |   |   |     |         | | |     |     |         |       |   |   
 +-|-----------+ |   +-------|---|-------|---------------|---------------|-------|-----------|-------|---------|-|---|-----|-------|---|-------|-----|-----+   | | |     |     |         |       |   |   
   | | |       | |     |     |   |       | |         |   |   | | | |   | | |   | | |   |     | |     |         | |   |     |       | | |   |   |     |     |   | | |     |     |         |       |   |   
 +-|---+       | |     +-----------------------------|---|-----|-|-|---|---+   | | |   +---+ +-------|---------|-|---------|---------|-+   |   |     |     |   | +-|-----------|---------------+ |   |   
 | | |         | |           |   |       | |         |   |   | | | |   | |     | | |       |   |     |         | |   |     |       | |     |   |     |     |   |   |     |     |         |     | |   |   
 | | |         | |           |   |       | |     +---|-------|-----|-----|-+   | | |       |   |     |         | |   |     |       | |     |   |     |     |   |   |     |     |         |     | |   |   
 | | |         | |           |   |       | |     |   |   |   | | | |   | | |   | | |       |   |     |         | |   |     |       | |     |   |     |     |   |   |     |     |         |     | |   |   
 | | |         +-|-+     +---------------|-|-----|-------|---|-|-|-+   | | +-----|-------+ +---------|-+       | |   |     |       | |     |   |     |     |   |   |     |     |         |     | |   |   
 | | |           | |     |   |   |       | |     |   |   |   | | |     | |     | | |     |     |     | |       | |   |     |       | |     |   |     |     |   |   |     |     |         |     | |   |   
 | | |     +-----|-|---------|---|-------|-|-----|---|---------------------------+ |     |     |     +---------|-|---|---------------|-----|---------+     |   |   |     |   +-|---------|-----|-|-+ |   
 | | |     |     | |     |   |   |       | |     |   |   |   | | |     | |     |   |     |     |       |       | |   |     |       | |     |   |           |   |   |     |   | |         |     | | | |   
 | | |     |     | |     |   |   |       | |   +-----|-----------|-------|-+   | +-|-----|-----|-------|-------------|-----|-------|-------|---|---------------|---|-----------|---------|-----|-+ | |   
 | | |     |     | |     |   |   |       | |   | |   |   |   | | |     | | |   | | |     |     |       |       | |   |     |       | |     |   |           |   |   |     |   | |         |     |   | |   
 | | | +---|-----|-----------|---|-------|-------|---|---|-----|-|-------------|---------|---------------------|-|-------------------------+   |           |   |   |     |   | |         |     +---+ |   
 | | | |   |     | |     |   |   |       | |   | |   |   |   | | |     | | |   | | |     |     |       |       | |   |     |       | |         |           |   |   |     |   | |         |           |   
 | | | |   |     | |     |   +---|---------------|-+ |   |   | | |     | | |   | | | +---|-----|-------|-------------|-----------------------------------------|---|---------|---+       |           |   
 | | | |   |     | |     |       |       | |   | | | |   |   | | |     | | |   | | | |   |     |       |       | |   |     |       | |         |           |   |   |     |   | | |       |           |   
 | | | | +-|---+ | |     |       |       | |   +-|-|-----|-----------------|---+ | | |   |     |       |       | |   |     |       | |         |           |   |   |     |   | | |       |           |   
 | | | | | |   | | |     |       |       | |     | | |   |   | | |     | | |     | | |   |     |       |       | |   |     |       | |         |           |   |   |     |   | | |       |           |   
 | | +-----|-------|-----|---------------|-------|-|-------------|-----|-----------|-|-------------------------|-----|-----|-------|-----------|-----------|---|---|--------M|---+     +-|-----------|-+ 
 | |   | | |   | | |     |       |       | |     | | |   |   | | |     | | |     | | |   |     |       |       | |   |     |       | |         |           |   |   |     |   | |       | |           | | 
 | | +-|-------|-|-------|-------|---------|---------|---------------------|---------|---|-+   |       +-------|-----------|-------|-----------|-------------------|-----|-+ | |     +---+           | | 
 | | | | | |   | | |     |       |       | |     | | |   |   | | |     | | |     | | |   | |   |               | |   |     |       | |         |           |   |   |     | | | |     | |             | | 
 | | +-+ +---------|-------+     |       | |     | | |   |   | | | +---+ | |   +-|-|-|---+ +---------------------+   |     |       | |         |           |   |   |     | | | |     | |             | | 
 | |       |   | | |     | |     |       | |     | | |   |   | | | |     | |   | | | |         |               |     |     |       | |         |           |   |   |     | | | |     | |             | | 
 | |     +-|---|-|-------------------------|-------|---------|-|-|-|-----------|---+ +-------------------+ +---------|-----+       | |         |           |   |   |     | | | |     | |             | | 
 | |     | |   | | |     | |     |       | |     | | |   |   | | | |     | |   | |             |         | |   |     |             | |         |           |   |   |     | | | |     | |             | | 
 | |     | |   | | |     | |     |       | |     | | |   |   | | | |     | |   | |             |         | |   |     |             | |         |           |   |   |     | | +---------|-----------+ | | 
 | |     | |   | | |     | |     |       | |     | | |   |   | | | |     | |   | |             |         | |   |     |             | |         |           |   |   |     | |   |     | |           | | | 
 | |     | |   | | |     | |     |       | |     | | |   |   | | | |     | |   | |             |         | |   |     +---------------|---------+   +-------|---|---------|-+ +-|-------|-+         | | | 
 | |     | |   | | |     | |     |       | |     | | |   |   | | | |     | |   | |             |         | |   |                   | |             |       |   |   |     |   | |     | | |         | | | 
 | |     | |   | | |     | |     |       | |     | | |   |   | | | +-----------|-+             |         | +---|---------+         | |             |       |   |   |     |   | |     | | |         | | | 
 | |     | |   | | |     | |     |       | |     | | |   |   | | |       | |   |               |         |     |         |         | |             |       |   |   |     |   | |     | | |         | | | 
 | | +-----+   +-|-+     | |     |       | |     | | |   |   | | |       | +---+       +-----------------------------------------------------------------------|-----------+ | |   +---|-|-------------+ 
 | | |   |       |       | |     |       | |     | | |   |   | | |       |             |       |         |     |         |         | |             |       |   |   |     | | | |   | | | |         | |   
 | | |   |       |       +---------------|-------|---|---------------------------------+       |         |     |     +---+         | |             |   +-------------+   | | | |   +---|-|-------------Z 
 | | |   |       |         |     |       | |     | | |   |   | | |       |                     |         |     |     |             | |             |   |   |   |   | |   | | | |     | | |         | |   
 | +-|---+       |       +-|-----+       | |     | | |   |   | | |       |                     |         +-------------------------|-------------+ +---|---|---|---------------|-----|-+ +-----+   +-|-+ 
 |   |           |       | |             | |     | | |   |   | | |       |                     |               |     |             | |           |     |   |   |   | |   | | | |     |         |     | | 
 |   |     +-----|-------|-+         +---|-------|-------------|-|-------|-------------------------------------|-------------------|-|-----------|-----|-------|---|-|-------|-|---------------|-----|-+ 
 |   |     |     |       |           |   | |     | | |   |   | | |       |                     |               |     |             | |           |     |   |   |   | |   | | | |     |         |     |   
 |   |     |     |       |     +-----------------|-|-|-------------------+         +-----------|---------------------|-------------|-------------+     |   |   +---|-|---+ | | |     |         |     |   
 |   |     |     |       |     |     |   | |     | | |   |   | | |                 |           |               |     |             | |                 |   |       | |     | | |     |         |     |   
 |   +-------------------|-----------|---+ |     | +---+ +-------|-----------------+           |               |     +-+           +-|-----+           |   +-------------------|---+ +-----------------+ 
 |         |     |       |     |     |     |     |   | |     | | |                             |               |       |             |     |           |           | |     | | |   |           |     | | 
 |         |     |       +-----------------|-------------+   | | |                             +-------------+ +-------+             | +---|-------------------------------+ | +---|-----+     +-----|-+ 
 |         |     |             |     |     |     |   | | |   | | |                                           |                       | |   |           |           | |       |     |     |           |   
 |         |     |             |     +-----------|---|---|---|-+ |                                           |                       | +---|-----------|-----------+ |       |     |     |           |   
 |         |     |             |           |     |   J | |   |   |                                           |                       |     |           |             |       |     |     |           |   
 +---------|-----|-------------|-----------|---------|-|-----|-----------------------------------------------|-----------------------|-----|---------------------------------------------|-+         |   
           |     |             |           |     |   | | |   |   |                                           |                       |     |           |             |       |     |     | |         |   
           |     |   +---------+     +-+   +-----+   | | |   |   |       +-----------------------------------+       +---------------+     |           |           +---------|-----------+ |         |   
           |     |   |               | |             | | |   |   |       |                                           |                     |           |           | |       |     |       |         |   
           +-----|-------------------+ |             | | | +-------------+ +---------------------------------------------------------------+           +-----------+ +-------+     +---+   +---------+   
                 |   |                 |             | | | | |   |         |                                         |                                                                 |                 
                 +---+                 +-------------+ +-+ +-+   +---------+                                         +-----------------------------------------------------------------+                 `
